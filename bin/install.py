#!/usr/bin/python3
import os
a = input("Do you want to install OSL? You need about 3G space to install the standard configuration (2G space), according to the size of the image, enter y to continue")
if a=="y":
    print("Loading program")
    os.system("mkdir /opt/osl")
    os.system("mkdir /opt/osl/tmp")
    os.system("mkdir /opt/osl/arch")
    os.system("cp ./arch.tar.gz* /opt/osl/")
    os.system("cp ./arch.tar.gz* /opt/osl/arch/")
    os.system("cp ./startosl /opt/osl/")
    os.system("cp ./createosl /opt/osl")
    os.system("cp ./delosl /opt/osl")
    os.system("chmod 777 /opt/osl/startosl")
    os.system("chmod 777 /opt/osl/createoslosl")
    os.system("chmod 777 /opt/osl/delosl")
    print("OK")
    b = input("How much space do you want to allocate to OSL? (mb)")
    name = input("What the name of the OSL?")
    print("Creating mirror")
    os.chdir("/opt/osl/")
    os.system("dd if=/dev/zero of=./" + name + ".img bs=1M count=" + b + " status=progress")
    os.system("mkfs.ext4 ./" + name + ".img")
    print("OK")
    print("Mounting image")
    os.system("mount ./" + name + ".img /opt/osl/tmp/")
    print("OK")
    print("Preparing to copy files")
    os.system("mv ./arch.tar.gz* /opt/osl/tmp/")
    print("OK")
    print("Start copying files")
    os.chdir("./tmp")
    os.system("cat arch.tar.gz* | tar -zx")
    os.system("tar -zxvf arch.tar.gz")
    print("OK")
    print("Cleaning up temporary files")
    os.system("rm -rf ./arch.tar.g*")
    os.chdir("../")
    os.system("umount /opt/osl/tmp/")
    print("OK")
    print("Installing OSL launcher")
    os.system("ln -s /opt/osl/startosl /usr/bin/startosl")
    os.system("ln -s /opt/osl/createosl /usr/bin/createosl")
    os.system("ln -s /opt/osl/delosl /usr/bin/delosl")
    os.system("apt install arch-install-scripts -y")
    print("OK!Install complete!")
else:
    exit()
