#!/usr/bin/python3
import os
a = input("是否安装OSL？需要大约3G空间即可安装标配(2G空间),按照镜像大小判定,输入y继续")
if a=="y":
    print("正在加载程序")
    os.system("mkdir /opt/osl")
    os.system("mkdir /opt/osl/tmp")
    os.system("cp ./arch.tar.gz* /opt/osl/")
    os.system("cp ./startosl /opt/osl/")
    os.system("chmod 777 /opt/osl/startosl")
    print("OK")
    b = input("你要分配给OSL多大空间?(mb)")
    print("正在创建镜像")
    os.chdir("/opt/osl/")
    os.system("dd if=/dev/zero of=./disk.img bs=1M count=" + b + " status=progress")
    os.system("mkfs.ext4 ./disk.img")
    print("OK")
    print("正在挂载镜像")
    os.system("mount ./disk.img /opt/osl/tmp/")
    print("OK")
    print("正在准备复制文件")
    os.system("mv ./arch.tar.gz* /opt/osl/tmp/")
    print("OK")
    print("开始复制文件")
    os.chdir("./tmp")
    os.system("cat arch.tar.gz* | tar -zx")
    os.system("tar -zxvf arch.tar.gz")
    print("OK")
    print("正在清理临时文件")
    os.system("rm -rf ./arch.tar.g*")
    os.chdir("../")
    os.system("umount ./disk.img")
    print("OK")
    print("正在安装OSL启动器")
    os.system("ln /opt/osl/startosl /usr/bin/startosl")
    os.system("apt install arch-install-scripts -y")
    os.system("apt install aria2 -y")
    print("OK!安装完成!")
else:
    exit()
